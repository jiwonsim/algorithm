import Foundation

class Boj6087 {
    
    struct Pair {
        var r: Int, c: Int
        init(_ r: Int, _ c: Int) {
            self.r = r
            self.c = c
        }
    }
    
    let dirs = [[1, 0], [0, 1],
                [-1, 0], [0, -1]]
    
    var W: Int = Int(), H: Int = Int()
    var laser: [[Int]] = [[-1, -1], [-1, -1]]
    var map: [[Character]] = [[Character]]()
    
    private func isInNotRange(_ r: Int, _ c: Int) -> Bool {
        return r < 0 || c < 0 || r >= H || c >= W
    }
    
    private func go() -> Int {
        var que = [Pair](), head = 0
        var visited = [[Int]](repeating: [Int](repeating: -1, count: W), count: H)
        
        // 초기값 넣기
        visited[laser[0][0]][laser[0][1]] = 0
        que.append(Pair(laser[0][0], laser[0][1]))
        
        // 탐색 시작
        while head < que.count {
            let cur = que[head]
            head+=1
            
            if cur.r == laser[1][0] && cur.c == laser[1][1] {
                // 찾았다!
                return visited[cur.r][cur.c]
            }
            
            for dir in 0..<dirs.count {
                var nr = cur.r + dirs[dir][0]
                var nc = cur.c + dirs[dir][1]
                
                while !isInNotRange(nr, nc) && map[nr][nc] != "*" {
                    // 이전에 방문한 이력이 없을 때만 que에 넣어주기 -> 안 그러면 메모리 초과
                    if visited[nr][nc] == -1 {
                        que.append(Pair(nr, nc))
                        visited[nr][nc] = visited[cur.r][cur.c]+1
                    }
                    // 방문한 적이 있을 때 멈추지 않고 계속 탐색한다.
                    nr+=dirs[dir][0]
                    nc+=dirs[dir][1]
                }
            }
        }
        return -1
    }
    
    func main() {
        guard let WH = readLine()?.split(separator: " ").compactMap({Int(String($0))}) else { return }
        
        W = WH[0]
        H = WH[1]
        
        map = [[Character]](repeating: [Character](), count: H)
        
        for i in 0..<H {
            guard let input = readLine() else { return }
            map[i] = Array(input)
            for j in 0..<W {
                if map[i][j] == "C" {
                    if laser[0][0] == -1 {
                        laser[0][0] = i
                        laser[0][1] = j
                    }
                    else {
                        laser[1][0] = i
                        laser[1][1] = j
                    }
                }
            }
        }
        
        print(go()-1)
    }
}

Boj6087().main()


/*
4 4
C.**
..**
....
...C

답: 1


4 4
C...
....
**..
**.C

답: 1

4 4
**.C
**..
....
C...

답: 1



4 4
...C
....
..**
C.**

답: 1

4 7
....
..*.
C.*.
..*C
..*.
..*.
....

답: 2

4 7
....
.*..
.*.C
C*..
.*..
.*..
....

답: 2

7 4
...C...
.......
.*****.
...C...

답: 2





USACO January 2009 Contest  대회 공식 테스트 케이스 입니다.



7 8
.......
......C
......*
*****.*
....*..
....*..
.C..*..
.......
답 : 3

15 10
...*...***.C..*
.*.*.*........*
.*...*...*....*
.*.*....****.**
.*..**........*
.**..********.*
.*...*...*..*.*
.**..***.*.**.*
C........*.....
..***..........
답: 6

10 15
..........
**........
..**......
...*......
....*.....
.....*....
.....*....
....*..*..
....*...*.
...C*C...*
....*..*..
*..*.*....
..*.......
.......*..
..........
답: 4

20 30
....................
....................
....................
.................*..
................*...
...............*....
..............*.....
.............*......
............*.......
...........*........
..........*.........
.........*..........
.........*..........
.........*..........
.........*..........
.........*..........
.C.......*........C.
.........*..........
.........*..........
.........*..........
.........*..........
...*.....*..........
..*.*....*..........
.*...*...*..........
*.....*.*...........
.......*............
....................
....................
....................
....................
답: 2

20 41
C...................
.*..................
..***...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
...........*........
....................
.........*..........
.......*............
.........*..........
.....*..............
....*...............
....*..*............
....*....*..........
....*...............
....*.*.............
....*......*........
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
....*...............
*............C......
답: 1

36 40
*...................................
.*..*....************************...
..*..*...*C.....................*...
......*..********************...*...
.............................*.*....
..************************..*...*...
.*.......................*.*...*...*
*..********************..*..**.*....
......................*.....*..*....
............*..........*.*.*....*...
*******************.*..**.*.....*...
..................*...*........*....
.**************...*...*.*******...*.
..............*...*...*.............
.*............*...*...*...*.........
.*.************...*...*..*.*........
**............*...*...*.*...*.......
..*...........*...*...**.....*......
...*..........*...*...*.*.....*.....
....*.........*...*...*..*..........
.....*........*...*...*...*.........
......*.......*.*.*...*....*.......*
.......*......*...*...*.....*.....*.
*************.*...*...*......*...*..
*.............*...*...*.......*.*...
*..*..*...*....*..**..*........*....
*..*.*.*.*.**.*...*...*.............
*..**...*....*....*...*.............
*..*..............*...*.............
*..*.**************...*.............
*..*..............*...*.............
**C*.............*....*.............
..*.............*.....*.............
...............*......*.............
......................*.............
......................*.............
***.***.*.*.*.***.***..*..*.*...***.
*...*.*.*.*.*.**..***..*..*.*...**..
*...*.*..*.*...**.*.*..*..*.*...*...
***.***..*.*..***.*..*.****.***.***.
답: 27

50 45
......................................*...........
.......................................*..........
......................................*...........
.....................................*............
....................................*.............
...................................*..............
..................................*...............
.................................*................
................................*.................
...............................*..................
..............................*...................
.............................*....................
............................*.....................
...........................*.*....................
...........C..............*.......................
*******.******************........................
.........................*..*.....................
.........................*...*....................
.........................*....*...................
.........................*.....*..................
.........................*......*.................
............*............*.......*................
...........*.*...........*........*...............
..........*...*..........*.........*..............
.........*.....*.........*..........*.............
........*.......*........*...........*............
.......*.........*.......*............*...........
......*...........*......*.............*..........
.....*.............*.....*..............*.........
....*...............*....*********......*.........
....*...............*...*...*....C......*.........
.....*...............*.*...*.*...*......*.........
......*...............*.......*.........*.........
.......*.......................*........*.........
........*.......................*.......*.........
.........*.......................*......*.........
..........*.......................*....*..........
...........*.......................*..*...........
............*.......................**............
.............*.......................*............
..............*.......................*...........
...............*.......................*..........
................*.......................*.........
.................*......................*.........
..................................................
답: 10

43 39
...........................................
...........................................
...........................................
...........................................
............**.........**..................
...........***.........***.................
..........***...........***................
..........****...***...****................
...........******...******.................
............****.....****..................
..............**.....**....................
........*****.*.......*.*****...*..*.......
.......*..*****..*.*..*****..*..****.......
.......****.**.........**.****..****.......
........****.*.........*.****...****.......
...........*.*.........*..*.....*.**.......
..........*.*...*****...*..*....*..........
.........**.****.....****...*...*..*.......
............*...........*...*...*..*.......
........*....*.**...**.**....*.*...*.......
........*....*.........*.....*.*...*.......
.......*......*.......*.......**...*.......
.......*....*..********............*.......
......*....**.........**...**......*.......
......*...**...........**...**....**.......
.....*...**.............**...**..**........
.....*...*...............**...*****........
.....*...*...............**...****.........
.....*....**.............*.*..*............
.....*......*............*..*.*............
.....***.....*.................*...........
......*****C***................*...........
.......*C*******...............*...........
.......*....****...............*...........
.......*.......................*...........
.......*************************...........
...........................................
...........................................
...........................................
답: 8

60 40
************************************************************
*..........................................*............*...
*.********************************.........*............*..*
*.*....*....................*....*.........*.........*..*..*
*.*.*..*******..*******.....*....*....*....*.........*..*..*
*.*.*.................*.....*..*.*....*....*.........*..*..*
*.*.*************************..*.*....*....*.........*..*..*
*..............................*.*....*....*.........*..*..*
********************************.*....*....*......*..*..*..*
*................................*..************..*..*..*..*
*..*******************************................*..*..*..*
*..*.............................*................*..*..*...
*..*..........................*..*................*..*..*...
*..*..........................*..******************..*..*..*
*..*..........................*......................*..*..*
*..*..........................*..*..******************..*..*
*..*..........................*..*...................*..*..*
*..*..........................*..******************..*..*..*
*..*..........................*..*...................*..*..*
*..*..........................*..*...................*..*..*
*..*..........................*..*...................*..*..*
*..*..........................*..*...************....*..*..*
*..*..........................*..*...*...........*...*..*..*
*..*..........................*..*...*...........*...*..*..*
*..*........................***..*...*...........**..*..*..*
*..*........................*....*...*..........*....*..*...
*..*........................*........*.........**....*..*...
*..*.............*****************...*.........*.....*..*..*
*..*...........***...............*...*...............*..*..*
*..*..........*..*....********...*...*****************..*..*
*..*..........*..*...........*...*......................*..*
*..************.C*...........*.C.*...********************..*
*................*...........*...*..........................
*................*...........*...*..........................
******************.....***********************..************
.........**......................*..*......................*
.......................................*..*..*..........****
....******************************************.............*
...........................................................*
...............................................*************
답: 24

100 100
....................................................................................................
....................................................................................................
....................................................................................................
**..................................................................................................
..*.................................................................................................
...*................................................................................................
....*...............................................................................................
.....*..............................................................................................
......*.............................................................................................
.......*............................................................................................
........*...........................................................................................
.........*..........................................................................................
..........*.........................................................................................
...........*........................................................................................
...........*........................................................................................
...........*........................................................................................
...........*.......................................................................................*
............**..**..**......**......***....****...................................................*.
............**..**.*.......****....*...*..*....*...*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*..*..*.*.*.*.*..
............**..**..**....**..**...*C.....*....*..*..*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*.*
............**..**....*..********..*...*..*....*.*................................................*.
.............****..***..**......**..***....****.*..................................................*
*..............................................*....................................................
.*............................................*.....................................................
..*..............................*******.....*......................................................
...*............................**......*...*.............*............*............................
....*...............*...........*........*.*.............**............**...........................
.....*.............*.*..........*.........*.............**..............**..........................
......*...........*...*.........*.........**...........**................**.........................
.......*......****.....*.......*............*..........**................**.........................
........*....*..........*.....*.............*..........***..............***.........................
.........*..*............*...*...............*..........***...******...***..........................
..........**..............***.................*.........*******....*******..........................
...............................................*.......*..................*.........................
......................................................*....***......***....*........................
.................................................*...*....*...*....*...*....*.......................
..................................................*..*....*.***....*.***....*.......................
...................................................*.*.....***......***.....*.......................
....................................................*.*....................*........................
.......................................................*.....********.....*.........................
........................................................*...*.**..**.*...*..........................
.........................................................*..*........*..*...........................
.................................................*********..*.*.****.*.*............................
..........................................******..............******...****.........................
...............***************************................................***.......................
...........****.............................................................**......................
..........*.......................................*..........................*......................
.........*...**...................................*..........................*......................
.........*..*.*....................................*.......*.........*.......*......................
.........*.*..*....................................*......*...........*......*......................
.........*.*...*...............*....................*.....*...........*.....*.......................
.........*.*....*..............*....................*....*.............*....*.......................
.........*.*.....*............*.....................*....*.............*....*.......................
.........*.*......*..........*......................*....*..........****....*.......................
.........*.*.......*........*****....................*..*........***....*..*........................
.........*.*........*......*...*.*********************..*********.......*..*........................
.........*.*.......*......*...*......................*..*...............*..*........................
.........*.*......*......*...*.......................*..*...............*..*************************
........*...*......*....*...*........................*..*...............*..*........................
.........*C*........*...*...*........................*..*...............*..*........................
..........*..........*...*...*.......................*..*...............*...........................
......................*****.***......................****...............****........................
.......................******.***...................******.............******.......................
....................................................*.....*.........................................
...................................................*.......*........................................
..............**.........**.......................*.........*..**.........**........................
.............***.........***.....................*...........****.........***.......................
............***...........***...................*............***...........***......................
............****...***...****..................*.............****...*.*...****......................
.............******...******..................*...............******...******.......................
..............****.....****..................*.................****.....****........................
................**.....**...................*....................**.....**..........................
..........*****.*.......*.*****...*..*.....*...............*****.*.......*.*****...*..*.............
.........********..*.*..********..****....*...............********..*.*..********..****.............
.........*******.........*******..****...*................*******.........*******..****.............
..........****.*.........*.****...****..*..................****.*.........*.****...****.............
.............*.*.........*..*.....*.**.*......................*.*.........*..*.....*.**.............
............*.*...*****...*..*....*..**......................*.*...*****......*....*..*.............
...........**.*************...*...*..*......................**.*************...*...*..*.............
...........*..*************...*...*..*......................*..*************...*...*..*.............
..........*....************....*.*...*.....................*....************....*.*...*.............
..........*....***********.....*.*...*.....................*....***********.....*.*...*.............
.........*......*********.......**...*....................*......*********.......**...*.............
.........*....*..********.................................*....*..********............*.............
........*....**.........**...**......*...................*....**.........**...**......*.............
........*...**...........**...**....**...................*...**...........**...**....**.............
.......*...**.............**...**..**...................*...**.............**...**..**..............
.......*...*...............**...*****...................*...*...............**...*****..............
.......*...*...............**...****....................*...*...............**...****...............
.......*....**.............*.*..*............................**.............*.*..*..................
.......*......*............*..*.*.......................*......*............*....*..................
.......***.....*.................*......................***.......................*.................
........*****.***................*.......................*****.***................*.................
.........*.*******...............*........................*.*******...............*.................
.........*....***................*........................*....****...............*.................
.........*....***.*****.****.....*........................*....***.*****.****.....*.................
.........********.****************........................*************************.................
...................*................................................................................
...................*................................................................................
...................*................................................................................
답: 9
*/
